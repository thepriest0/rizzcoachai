<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rizz Coach</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    :root {
      --primary: #7F56D9;
      --primary-light: #F9F5FF;
      --primary-dark: #6941C6;
      --secondary: #101828;
      --gray-50: #F9FAFB;
      --gray-100: #F2F4F7;
      --gray-200: #EAECF0;
      --gray-300: #D0D5DD;
      --gray-500: #667085;
      --gray-700: #344054;
      --gray-900: #101828;
      --success: #12B76A;
      --warning: #F79009;
      --error: #F04438;
      --partner-pink: #EC4899;
      --partner-pink-light: #FCE7F3;
      --partner-blue: #3B82F6;
      --partner-blue-light: #EFF6FF;
      --border-radius: 8px;
      --shadow-sm: 0px 1px 2px rgba(16, 24, 40, 0.05);
      --shadow-md: 0px 4px 8px -2px rgba(16, 24, 40, 0.1), 0px 2px 4px -2px rgba(16, 24, 40, 0.06);
      --shadow-lg: 0px 12px 16px -4px rgba(16, 24, 40, 0.08), 0px 4px 6px -2px rgba(16, 24, 40, 0.03);
      --transition: all 0.2s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--gray-50);
      color: var(--gray-900);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }
    
    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }
    
    /* Header Styles */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      margin-bottom: 24px;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .logo-icon {
      width: 32px;
      height: 32px;
      background-color: var(--primary);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
    }
    
    .logo-text {
      font-size: 20px;
      font-weight: 600;
      color: var(--gray-900);
    }
    
    .user-menu {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .user-name {
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-700);
    }
    
    .logout-button {
      background: none;
      border: none;
      color: var(--gray-500);
      cursor: pointer;
      font-size: 14px;
      padding: 4px 8px;
      border-radius: var(--border-radius);
      transition: var(--transition);
    }
    
    .logout-button:hover {
      background-color: var(--gray-100);
      color: var(--gray-700);
    }
    
    .nav-tabs {
      display: flex;
      gap: 8px;
      border-bottom: 1px solid var(--gray-200);
      margin-bottom: 24px;
    }
    
    .nav-tab {
      padding: 12px 16px;
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-700);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: var(--transition);
    }
    
    .nav-tab:hover {
      color: var(--primary);
    }
    
    .nav-tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }
    
    /* Main App Layout */
    .app-layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
    }
    
    @media (min-width: 1024px) {
      .app-layout {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    /* Card Styles */
    .card {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--gray-200);
      overflow: hidden;
    }
    
    .card-header {
      padding: 16px 24px;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--gray-900);
    }
    
    .card-body {
      padding: 24px;
    }
    
    /* Form Elements */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group:last-child {
      margin-bottom: 0;
    }
    
    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-700);
      margin-bottom: 6px;
    }
    
    textarea {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--gray-300);
      border-radius: var(--border-radius);
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      color: var(--gray-900);
      resize: none;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
      min-height: 120px;
    }
    
    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-light);
    }
    
    .input-field {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--gray-300);
      border-radius: var(--border-radius);
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      color: var(--gray-900);
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }
    
    .input-field:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-light);
    }
    
    /* Option Groups */
    .option-group {
      margin-bottom: 20px;
    }
    
    .option-group:last-child {
      margin-bottom: 0;
    }
    
    .option-group-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-700);
      margin-bottom: 8px;
    }
    
    .option-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .option-button {
      background-color: white;
      border: 1px solid var(--gray-300);
      color: var(--gray-700);
      padding: 8px 14px;
      border-radius: 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .option-button:hover {
      background-color: var(--gray-50);
      border-color: var(--gray-400);
    }
    
    .option-button.active {
      background-color: var(--primary-light);
      border-color: var(--primary);
      color: var(--primary);
    }
    
    /* Primary Button */
    .primary-button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: var(--border-radius);
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }
    
    .primary-button:hover {
      background-color: var(--primary-dark);
    }
    
    .primary-button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }
    
    /* Secondary Button */
    .secondary-button {
      background-color: white;
      color: var(--gray-700);
      border: 1px solid var(--gray-300);
      padding: 8px 14px;
      border-radius: var(--border-radius);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .secondary-button:hover {
      background-color: var(--gray-50);
      border-color: var(--gray-400);
    }
    
    /* Loading Spinner */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 0;
      gap: 16px;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--primary-light);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    
    .loading-text {
      font-size: 14px;
      color: var(--gray-500);
    }
    
    /* Response Cards */
    .responses {
      display: grid;
      gap: 12px;
    }
    
    .response-card {
      background-color: var(--primary);
      color: white;
      border-radius: var(--border-radius);
      padding: 16px;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      border-bottom-right-radius: 4px;
    }
    
    .response-card:hover {
      background-color: var(--primary-dark);
      box-shadow: var(--shadow-md);
    }
    
    .response-card.selected {
      background-color: var(--primary-dark);
      box-shadow: var(--shadow-md);
    }
    
    .response-card.selected::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background-color: white;
      border-top-left-radius: var(--border-radius);
      border-bottom-left-radius: var(--border-radius);
    }
    
    /* Action Buttons */
    .action-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 16px;
    }
    
    /* Error Message */
    .error-message {
      background-color: #FEF3F2;
      color: var(--error);
      padding: 12px 16px;
      border-radius: var(--border-radius);
      margin-bottom: 16px;
      border: 1px solid #FEE4E2;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Utility Classes */
    .hidden {
      display: none;
    }
    
    .mt-4 {
      margin-top: 16px;
    }
    
    .mb-4 {
      margin-bottom: 16px;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .app-container {
        padding: 16px;
      }
      
      .card-body {
        padding: 16px;
      }
      
      .option-buttons {
        flex-wrap: wrap;
      }
    }
    
    /* Chat Preview */
    .chat-preview {
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .chat-header {
      padding: 16px;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .chat-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--gray-200);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: var(--gray-700);
    }
    
    .chat-avatar.boyfriend {
      background-color: var(--partner-blue-light);
      color: var(--partner-blue);
    }
    
    .chat-avatar.girlfriend {
      background-color: var(--partner-pink-light);
      color: var(--partner-pink);
    }
    
    .chat-info {
      flex: 1;
    }
    
    .chat-name {
      font-weight: 600;
      font-size: 14px;
      color: var(--gray-900);
    }
    
    .chat-status {
      font-size: 12px;
      color: var(--gray-500);
    }
    
    .chat-messages {
      flex: 1;
      padding: 16px;
      background-color: var(--gray-50);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 300px;
      max-height: 500px;
    }
    
    .message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .message-received {
      align-self: flex-start;
      background-color: white;
      border: 1px solid var(--gray-200);
      border-bottom-left-radius: 4px;
      color: var(--gray-900);
    }
    
    .message-sent {
      align-self: flex-end;
      background-color: var(--primary);
      color: white;
      border-bottom-right-radius: 4px;
    }
    
    .message-partner {
      align-self: flex-start;
      border-bottom-left-radius: 4px;
      color: white;
    }
    
    .message-partner.boyfriend {
      background-color: var(--partner-blue);
    }
    
    .message-partner.girlfriend {
      background-color: var(--partner-pink);
    }
    
    .chat-input {
      padding: 16px;
      border-top: 1px solid var(--gray-200);
      display: flex;
      gap: 12px;
    }
    
    .chat-input-field {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid var(--gray-300);
      border-radius: 24px;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
    }
    
    .chat-input-field:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .send-button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--primary);
      color: white;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .send-button:hover {
      background-color: var(--primary-dark);
    }
    
    .send-button.boyfriend {
      background-color: var(--partner-blue);
    }
    
    .send-button.boyfriend:hover {
      background-color: #2563EB;
    }
    
    .send-button.girlfriend {
      background-color: var(--partner-pink);
    }
    
    .send-button.girlfriend:hover {
      background-color: #DB2777;
    }
    
    /* Rizz Meter */
    .rizz-meter {
      margin-top: 16px;
      background-color: white;
      border: 1px solid var(--gray-200);
      border-radius: var(--border-radius);
      padding: 16px;
    }
    
    .rizz-meter-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .rizz-meter-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-700);
    }
    
    .rizz-meter-value {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary);
    }
    
    .rizz-meter-bar {
      height: 8px;
      background-color: var(--gray-200);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .rizz-meter-fill {
      height: 100%;
      background-color: var(--primary);
      border-radius: 4px;
      width: 85%;
    }
    
    /* AI Partner Chat */
    .partner-setup {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 24px;
    }
    
    @media (max-width: 768px) {
      .partner-setup {
        grid-template-columns: 1fr;
      }
    }
    
    .partner-type-button {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      border: 1px solid var(--gray-200);
      border-radius: var(--border-radius);
      background-color: white;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .partner-type-button:hover {
      border-color: var(--gray-300);
      box-shadow: var(--shadow-sm);
    }
    
    .partner-type-button.selected.boyfriend {
      border-color: var(--partner-blue);
      background-color: var(--partner-blue-light);
    }
    
    .partner-type-button.selected.girlfriend {
      border-color: var(--partner-pink);
      background-color: var(--partner-pink-light);
    }
    
    .partner-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
      font-size: 24px;
      font-weight: 600;
    }
    
    .partner-icon.boyfriend {
      background-color: var(--partner-blue-light);
      color: var(--partner-blue);
    }
    
    .partner-icon.girlfriend {
      background-color: var(--partner-pink-light);
      color: var(--partner-pink);
    }
    
    .partner-label {
      font-size: 16px;
      font-weight: 500;
      color: var(--gray-900);
    }
    
    .personality-selector {
      margin-top: 24px;
    }
    
    .personality-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    
    .personality-button {
      background-color: white;
      border: 1px solid var(--gray-300);
      color: var(--gray-700);
      padding: 8px 14px;
      border-radius: 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .personality-button:hover {
      background-color: var(--gray-50);
      border-color: var(--gray-400);
    }
    
    .personality-button.active.boyfriend {
      background-color: var(--partner-blue-light);
      border-color: var(--partner-blue);
      color: var(--partner-blue);
    }
    
    .personality-button.active.girlfriend {
      background-color: var(--partner-pink-light);
      border-color: var(--partner-pink);
      color: var(--partner-pink);
    }
    
    .start-chat-button {
      margin-top: 24px;
    }
    
    .start-chat-button.boyfriend {
      background-color: var(--partner-blue);
    }
    
    .start-chat-button.boyfriend:hover {
      background-color: #2563EB;
    }
    
    .start-chat-button.girlfriend {
      background-color: var(--partner-pink);
    }
    
    .start-chat-button.girlfriend:hover {
      background-color: #DB2777;
    }
    
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 8px 16px;
      background-color: white;
      border-radius: 16px;
      border: 1px solid var(--gray-200);
      align-self: flex-start;
      margin-bottom: 8px;
    }
    
    .typing-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: var(--gray-500);
      animation: typingAnimation 1.4s infinite ease-in-out;
    }
    
    .typing-dot:nth-child(1) {
      animation-delay: 0s;
    }
    
    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes typingAnimation {
      0%, 60%, 100% {
        transform: translateY(0);
      }
      30% {
        transform: translateY(-4px);
      }
    }
    
    /* Auth Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }
    
    .modal {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-lg);
      width: 100%;
      max-width: 400px;
      padding: 24px;
      position: relative;
    }
    
    .modal-header {
      text-align: center;
      margin-bottom: 24px;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--gray-900);
      margin-bottom: 8px;
    }
    
    .modal-subtitle {
      font-size: 14px;
      color: var(--gray-500);
    }
    
    .modal-body {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .auth-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 16px;
      border-radius: var(--border-radius);
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      border: 1px solid var(--gray-300);
      background-color: white;
      color: var(--gray-700);
    }
    
    .auth-button:hover {
      background-color: var(--gray-50);
      border-color: var(--gray-400);
    }
    
    .auth-button img {
      width: 20px;
      height: 20px;
    }
    
    .auth-divider {
      display: flex;
      align-items: center;
      gap: 16px;
      margin: 16px 0;
    }
    
    .auth-divider-line {
      flex: 1;
      height: 1px;
      background-color: var(--gray-200);
    }
    
    .auth-divider-text {
      font-size: 14px;
      color: var(--gray-500);
    }
    
    .auth-terms {
      font-size: 12px;
      color: var(--gray-500);
      text-align: center;
      margin-top: 16px;
    }
    
    .auth-terms a {
      color: var(--primary);
      text-decoration: none;
    }
    
    .auth-terms a:hover {
      text-decoration: underline;
    }
    
    /* App Blur */
    .app-blur {
      filter: blur(4px);
      pointer-events: none;
      user-select: none;
    }
  </style>
</head>
<body>
  <!-- Auth Modal -->
  <div id="auth-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="logo" style="justify-content: center; margin-bottom: 16px;">
          <div class="logo-icon">R</div>
          <div class="logo-text">Rizz Coach</div>
        </div>
        <h2 class="modal-title">Sign in to Rizz Coach</h2>
        <p class="modal-subtitle">Level up your flirting game with personalized coaching</p>
      </div>
      <div class="modal-body">
        <div id="g_id_onload"
             data-client_id="981383295462-lp0h6euuofpp1ts3j49mkmd139qftmgk.apps.googleusercontent.com"
             data-context="signin"
             data-ux_mode="popup"
             data-callback="handleCredentialResponse"
             data-auto_prompt="false">
        </div>

        <div class="g_id_signin"
             data-type="standard"
             data-shape="rectangular"
             data-theme="outline"
             data-text="signin_with"
             data-size="large"
             data-logo_alignment="left"
             data-width="100%">
        </div>
        
        <div class="auth-divider">
          <div class="auth-divider-line"></div>
          <div class="auth-divider-text">or</div>
          <div class="auth-divider-line"></div>
        </div>
        
        <button id="guest-login" class="auth-button">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 8.75C11.7259 8.75 13.125 7.35089 13.125 5.625C13.125 3.89911 11.7259 2.5 10 2.5C8.27411 2.5 6.875 3.89911 6.875 5.625C6.875 7.35089 8.27411 8.75 10 8.75Z" stroke="#667085" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5 17.5V15C5 14.337 5.26339 13.7011 5.73223 13.2322C6.20107 12.7634 6.83696 12.5 7.5 12.5H12.5C13.163 12.5 13.7989 12.7634 14.2678 13.2322C14.7366 13.7011 15 14.337 15 15V17.5" stroke="#667085" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Continue as Guest
        </button>
        
        <p class="auth-terms">
          By continuing, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.
        </p>
      </div>
    </div>
  </div>

  <div id="app-container" class="app-container app-blur">
    <header>
      <div class="logo">
        <div class="logo-icon">R</div>
        <div class="logo-text">Rizz Coach</div>
      </div>
      
      <div id="user-menu" class="user-menu hidden">
        <img id="user-avatar" src="/placeholder.svg?height=32&width=32" alt="User Avatar" class="user-avatar">
        <span id="user-name" class="user-name">User Name</span>
        <button id="logout-button" class="logout-button">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 4px;">
            <path d="M6 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V3.33333C2 2.97971 2.14048 2.64057 2.39052 2.39052C2.64057 2.14048 2.97971 2 3.33333 2H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10.6667 11.3333L14.0001 7.99996L10.6667 4.66663" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M14 8H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Sign Out
        </button>
      </div>
    </header>
    
    <div class="nav-tabs">
      <div class="nav-tab active" data-tab="message-generator">Message Generator</div>
      <div class="nav-tab" data-tab="ai-partner">AI Partner Chat</div>
    </div>

    <!-- Message Generator Tab -->
    <div id="message-generator-tab" class="tab-content">
      <div class="app-layout">
        <!-- Message Generator Card -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Message Generator</h2>
          </div>
          <div class="card-body">
            <div id="error-container" class="error-message hidden">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 5.33333V8M8 10.6667H8.00667M14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8Z" stroke="#F04438" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              An error occurred. Please try again.
            </div>
            
            <div class="form-group">
              <label for="message-input">Their Message or Situation</label>
              <textarea id="message-input" placeholder="e.g., 'Hey, what are you up to?' or 'I matched with someone who loves hiking'"></textarea>
            </div>
            
            <div class="option-group">
              <div class="option-group-label">Tone</div>
              <div class="option-buttons tone-buttons">
                <button class="option-button active" data-tone="sweet">Sweet</button>
                <button class="option-button" data-tone="sarcastic">Sarcastic</button>
                <button class="option-button" data-tone="bold">Bold</button>
                <button class="option-button" data-tone="funny">Funny</button>
                <button class="option-button" data-tone="smooth">Smooth Talker</button>
              </div>
            </div>
            
            <div class="option-group">
              <div class="option-group-label">Interest Level</div>
              <div class="option-buttons level-buttons">
                <button class="option-button active" data-level="low-key">Low-key</button>
                <button class="option-button" data-level="confident">Confident</button>
                <button class="option-button" data-level="roast">Subtle Roast</button>
                <button class="option-button" data-level="romantic">Romantic</button>
              </div>
            </div>
            
            <div class="option-group">
              <div class="option-group-label">Mode</div>
              <div class="option-buttons mode-buttons">
                <button class="option-button active" data-mode="reply">Reply Generator</button>
                <button class="option-button" data-mode="opener">Opener Lines</button>
                <button class="option-button" data-mode="impression">Character Impression</button>
              </div>
            </div>
            
            <div id="impression-container" class="form-group hidden">
              <label for="impression-input">Talk like:</label>
              <input type="text" id="impression-input" class="input-field" placeholder="e.g., Drake, Tony Stark, Ryan Gosling">
            </div>
            
            <button id="generate-button" class="primary-button">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.99999 4.16667V15.8333M4.16666 10H15.8333" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Generate Rizz
            </button>
          </div>
        </div>

        <!-- Results Card -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Message Preview</h2>
          </div>
          <div class="card-body" style="padding: 0;">
            <div id="loading" class="loading hidden">
              <div class="spinner"></div>
              <div class="loading-text">Generating smooth responses...</div>
            </div>
            
            <div id="chat-preview" class="chat-preview">
              <div class="chat-header">
                <div class="chat-avatar">M</div>
                <div class="chat-info">
                  <div class="chat-name">Match</div>
                  <div class="chat-status">Online</div>
                </div>
              </div>
              
              <div class="chat-messages">
                <div class="message message-received" id="received-message">
                  wyd
                </div>
                
                <div id="results-container" class="hidden">
                  <div id="responses" class="responses"></div>
                  
                  <div class="rizz-meter">
                    <div class="rizz-meter-label">
                      <div class="rizz-meter-title">Rizz Level</div>
                      <div class="rizz-meter-value">85%</div>
                    </div>
                    <div class="rizz-meter-bar">
                      <div class="rizz-meter-fill"></div>
                    </div>
                  </div>
                  
                  <div class="action-buttons">
                    <button id="regenerate-button" class="secondary-button">
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 4px;">
                        <path d="M14 8.00004C14 11.3138 11.3137 14.0001 8 14.0001C4.68629 14.0001 2 11.3138 2 8.00004C2 4.68633 4.68629 2.00004 8 2.00004" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M14 2.66671L14 6.00004L10.6667 6.00004" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M11.333 4.66671L13.9997 2.00004" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                      </svg>
                      Regenerate
                    </button>
                    <button id="copy-button" class="secondary-button">
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 4px;">
                        <rect x="2.66666" y="2.66671" width="8" height="8" rx="1.33333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5.33334 13.3334H12C12.7364 13.3334 13.3333 12.7364 13.3333 12V5.33337" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      Copy
                    </button>
                  </div>
                </div>
              </div>
              
              <div class="chat-input">
                <input type="text" class="chat-input-field" placeholder="Type a message..." disabled>
                <button class="send-button" disabled>
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.3333 1.66671L9.16666 10.8334M18.3333 1.66671L12.5 18.3334L9.16666 10.8334M18.3333 1.66671L1.66666 7.50004L9.16666 10.8334" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- AI Partner Chat Tab -->
    <div id="ai-partner-tab" class="tab-content hidden">
      <div id="partner-setup-container">
        <h2 class="card-title mb-4">Choose Your AI Partner</h2>
        
        <div class="partner-setup">
          <div class="partner-type-button" data-partner="boyfriend">
            <div class="partner-icon boyfriend">ðŸ‘¨</div>
            <div class="partner-label">Boyfriend</div>
          </div>
          
          <div class="partner-type-button" data-partner="girlfriend">
            <div class="partner-icon girlfriend">ðŸ‘©</div>
            <div class="partner-label">Girlfriend</div>
          </div>
        </div>
        
        <div class="personality-selector">
          <div class="option-group-label">Personality Type</div>
          <div class="personality-buttons">
            <button class="personality-button active" data-personality="sweet">Sweet & Caring</button>
            <button class="personality-button" data-personality="flirty">Flirty & Playful</button>
            <button class="personality-button" data-personality="mysterious">Mysterious & Deep</button>
            <button class="personality-button" data-personality="passionate">Passionate & Romantic</button>
            <button class="personality-button" data-personality="confident">Confident & Direct</button>
          </div>
        </div>
        
        <button id="start-chat-button" class="primary-button start-chat-button" disabled>
          Start Chatting
        </button>
      </div>
      
      <div id="partner-chat-container" class="hidden">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title" id="partner-chat-title">Chat with Your Partner</h2>
            <button id="reset-chat-button" class="secondary-button">
              New Chat
            </button>
          </div>
          <div class="card-body" style="padding: 0;">
            <div id="partner-loading" class="loading hidden">
              <div class="spinner"></div>
              <div class="loading-text">Connecting...</div>
            </div>
            
            <div id="partner-chat" class="chat-preview">
              <div class="chat-header">
                <div class="chat-avatar" id="partner-avatar">ðŸ‘¨</div>
                <div class="chat-info">
                  <div class="chat-name" id="partner-name">Partner</div>
                  <div class="chat-status">Online</div>
                </div>
              </div>
              
              <div class="chat-messages" id="partner-messages">
                <!-- Messages will be added here dynamically -->
              </div>
              
              <div class="chat-input">
                <input type="text" id="partner-input" class="chat-input-field" placeholder="Type a message...">
                <button id="partner-send" class="send-button">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.3333 1.66671L9.16666 10.8334M18.3333 1.66671L12.5 18.3334L9.16666 10.8334M18.3333 1.66671L1.66666 7.50004L9.16666 10.8334" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // API endpoints
      const GENERATE_API_URL = "/api/generate";
      const PARTNER_API_URL = "/api/chat-partner";
      const GET_SESSION_API_URL = "/api/get-session";

      // Auth elements
      const authModal = document.getElementById('auth-modal');
      const guestLoginButton = document.getElementById('guest-login');
      const appContainer = document.getElementById('app-container');
      const userMenu = document.getElementById('user-menu');
      const userAvatar = document.getElementById('user-avatar');
      const userName = document.getElementById('user-name');
      const logoutButton = document.getElementById('logout-button');

      // User authentication state
      let currentUser = null;

      // Partner chat state
      let selectedPartnerType = null;
      let selectedPersonality = 'sweet';
      let partnerSessionId = null;
      let isPartnerTyping = false;

      // Check if user is already logged in (from localStorage)
      const storedUser = localStorage.getItem('rizzCoachUser');
      if (storedUser) {
        try {
          currentUser = JSON.parse(storedUser);
          handleAuthSuccess(currentUser);
          // Restore session after user is loaded
          restoreSession();
        } catch (error) {
          console.error('Error parsing stored user:', error);
          localStorage.removeItem('rizzCoachUser');
        }
      }

      // Google Sign-In callback
      window.handleCredentialResponse = async (response) => {
        const idToken = response.credential;
        try {
          const res = await fetch('/api/google-login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id_token: idToken })
          });

          if (!res.ok) throw new Error('Failed to verify ID token');
          const data = await res.json();
          const user = {
            id: data.user_id,
            name: data.name,
            email: data.email,
            picture: data.picture,
            isGuest: false
          };
          localStorage.setItem('rizzCoachUser', JSON.stringify(user));
          handleAuthSuccess(user);
          // Restore session after login
          restoreSession();
        } catch (error) {
          console.error('Error during Google login:', error);
        }
      };

      // Guest login
      guestLoginButton.addEventListener('click', () => {
        const guestUser = {
          id: 'guest-' + Math.random().toString(36).substring(2, 15),
          name: 'Guest User',
          email: '',
          picture: 'data:image/svg+xml;utf8,' + encodeURIComponent(
            `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
              <circle cx="50" cy="35" r="20" fill="#7F56D9" />
              <circle cx="50" cy="85" r="30" fill="#7F56D9" />
              <circle cx="40" cy="30" r="3" fill="white" />
              <circle cx="60" cy="30" r="3" fill="white" />
              <path d="M40,45 Q50,55 60,45" stroke="white" stroke-width="2" fill="none" />
            </svg>`
          ),
          isGuest: true
        };
        localStorage.setItem('rizzCoachUser', JSON.stringify(guestUser));
        handleAuthSuccess(guestUser);
        authModal.classList.add('hidden');
        // Store session after guest login
        restoreSession();
      });

      // Logout
      logoutButton.addEventListener('click', () => {
        localStorage.removeItem('rizzCoachUser');
        localStorage.removeItem('rizzCoachSession');
        handleLogout();
      });

      // Handle successful authentication
      function handleAuthSuccess(user) {
        currentUser = user;
        authModal.style.display = 'none';
        appContainer.classList.remove('app-blur');
        userAvatar.src = user.picture;
        userName.textContent = user.name;
        userMenu.classList.remove('hidden');
      }

      // Handle logout
      function handleLogout() {
        currentUser = null;
        authModal.classList.remove('hidden');
        appContainer.classList.add('app-blur');
        userMenu.classList.add('hidden');
      }

      // Function to restore session from localStorage and server
      async function restoreSession() {
        const storedSession = localStorage.getItem('rizzCoachSession');
        if (!currentUser || !storedSession) return;

        try {
          const sessionData = JSON.parse(storedSession);
          partnerSessionId = sessionData.sessionId;
          selectedPartnerType = sessionData.partnerType;
          selectedPersonality = sessionData.personality || 'sweet';

          // Fetch session from server
          const response = await fetch(GET_SESSION_API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sessionId: partnerSessionId, userId: currentUser.id })
          });

          if (!response.ok) {
            console.log('No session found on server, starting new session');
            localStorage.removeItem('rizzCoachSession');
            partnerMessages.innerHTML = ''; // Clear chat
            return;
          }

          const data = await response.json();
          // Update UI to show chat container
          partnerSetupContainer.classList.add('hidden');
          partnerChatContainer.classList.remove('hidden');
          updatePartnerInfo();

          // Clear existing messages
          partnerMessages.innerHTML = '';

          // Populate messages
          if (data.messages && Array.isArray(data.messages)) {
            data.messages.forEach(msg => {
              if (msg.role === 'user') {
                addUserMessage(msg.content);
              } else if (msg.role === 'assistant') {
                addPartnerMessage(msg.content);
              }
            });
          } else {
            console.warn('No messages found in session data');
          }

          // Scroll to bottom
          partnerMessages.scrollTop = partnerMessages.scrollHeight;
        } catch (error) {
          console.error('Error restoring session:', error);
          localStorage.removeItem('rizzCoachSession');
          partnerMessages.innerHTML = ''; // Clear chat on error
        }
      }

      // Tab Navigation
      const tabs = document.querySelectorAll('.nav-tab');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Remove active class from all tabs
          tabs.forEach(t => t.classList.remove('active'));
          // Add active class to clicked tab
          tab.classList.add('active');
          
          // Hide all tab contents
          tabContents.forEach(content => content.classList.add('hidden'));
          // Show the selected tab content
          const tabId = tab.dataset.tab + '-tab';
          document.getElementById(tabId).classList.remove('hidden');
        });
      });
      
      // Message Generator DOM Elements
      const messageInput = document.getElementById("message-input");
      const receivedMessage = document.getElementById("received-message");
      const toneButtons = document.querySelectorAll(".tone-buttons .option-button");
      const levelButtons = document.querySelectorAll(".level-buttons .option-button");
      const modeButtons = document.querySelectorAll(".mode-buttons .option-button");
      const impressionContainer = document.getElementById("impression-container");
      const impressionInput = document.getElementById("impression-input");
      const generateButton = document.getElementById("generate-button");
      const loadingElement = document.getElementById("loading");
      const chatPreview = document.getElementById("chat-preview");
      const resultsContainer = document.getElementById("results-container");
      const responsesContainer = document.getElementById("responses");
      const copyButton = document.getElementById("copy-button");
      const regenerateButton = document.getElementById("regenerate-button");
      const errorContainer = document.getElementById("error-container");
      const rizzMeterFill = document.querySelector(".rizz-meter-fill");
      const rizzMeterValue = document.querySelector(".rizz-meter-value");
    
      // Current selections for message generator
      let selectedTone = "sweet";
      let selectedLevel = "low-key";
      let selectedMode = "reply";
      let selectedResponseIndex = null;
    
      // Button click handlers for options
      function setupOptionButtons(buttons, updateFunction) {
        buttons.forEach((button) => {
          button.addEventListener("click", () => {
            // Remove active class from all buttons in the group
            buttons.forEach((btn) => btn.classList.remove("active"));
            // Add active class to clicked button
            button.classList.add("active");
            // Update the selected value
            updateFunction(button);
          });
        });
      }
    
      // Setup tone buttons
      setupOptionButtons(toneButtons, (button) => {
        selectedTone = button.dataset.tone;
      });
    
      // Setup level buttons
      setupOptionButtons(levelButtons, (button) => {
        selectedLevel = button.dataset.level;
      });
    
      // Setup mode buttons
      setupOptionButtons(modeButtons, (button) => {
        selectedMode = button.dataset.mode;
        // Show/hide impression input based on mode
        if (selectedMode === "impression") {
          impressionContainer.classList.remove("hidden");
        } else {
          impressionContainer.classList.add("hidden");
        }
      });
    
      // Update received message in chat preview
      messageInput.addEventListener("input", () => {
        const message = messageInput.value.trim();
        if (message) {
          receivedMessage.textContent = message;
        } else {
          receivedMessage.textContent = "wyd";
        }
      });
    
      // Generate button click handler
      generateButton.addEventListener("click", async () => {
        // Check if user is authenticated
        if (!currentUser) {
          authModal.classList.remove('hidden');
          return;
        }
        
        const message = messageInput.value.trim();
    
        if (!message) {
          alert("Please enter a message or situation first!");
          return;
        }
    
        // Hide error message if it was shown
        errorContainer.classList.add("hidden");
        
        // Show loading state
        loadingElement.classList.remove("hidden");
        chatPreview.classList.add("hidden");
        resultsContainer.classList.add("hidden");
    
        try {
          const responses = await generateResponses(message);
          displayResponses(responses);
          
          // Update Rizz Meter based on tone and level
          updateRizzMeter();
        } catch (error) {
          console.error("Error generating responses:", error);
          errorContainer.textContent = error.message || "Something went wrong. Please try again later.";
          errorContainer.classList.remove("hidden");
          chatPreview.classList.remove("hidden");
        } finally {
          // Hide loading state
          loadingElement.classList.add("hidden");
        }
      });
    
      // Function to generate responses using the API
      async function generateResponses(message) {
        try {
          // Prepare the request data
          const requestData = {
            message: message,
            tone: selectedTone,
            level: selectedLevel,
            mode: selectedMode,
            character: selectedMode === "impression" ? impressionInput.value.trim() : "",
            userId: currentUser?.id || 'guest'
          };
    
          // Call the API
          const response = await fetch(GENERATE_API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify(requestData)
          });
    
          // Check if the response is ok
          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "Failed to generate responses");
          }
    
          // Parse the response
          const data = await response.json();
          return data.responses;
        } catch (error) {
          console.error("API error:", error);
          
          // For development/demo purposes, fall back to mock responses if API fails
          console.log("Falling back to mock responses");
          return getMockResponses(selectedTone, selectedLevel, selectedMode, message);
        }
      }
    
      // Display the generated responses
      function displayResponses(responses) {
        responsesContainer.innerHTML = "";
    
        responses.forEach((response, index) => {
          const responseCard = document.createElement("div");
          responseCard.classList.add("message", "message-sent", "response-card");
          responseCard.textContent = `${index + 1}. ${response}`;
          responseCard.dataset.index = index;
    
          responseCard.addEventListener("click", () => {
            // Remove selected class from all cards
            document.querySelectorAll(".response-card").forEach((card) => {
              card.classList.remove("selected");
            });
    
            // Add selected class to clicked card
            responseCard.classList.add("selected");
            selectedResponseIndex = index;
          });
    
          responsesContainer.appendChild(responseCard);
        });
    
        chatPreview.classList.remove("hidden");
        resultsContainer.classList.remove("hidden");
    
        // Select the first response by default
        if (responsesContainer.firstChild) {
          responsesContainer.firstChild.classList.add("selected");
          selectedResponseIndex = 0;
        }
      }
    
      // Update Rizz Meter based on tone and level
      function updateRizzMeter() {
        let rizzScore = 75; // Base score
        
        // Adjust based on tone
        if (selectedTone === "smooth") rizzScore += 15;
        else if (selectedTone === "bold") rizzScore += 10;
        else if (selectedTone === "funny") rizzScore += 5;
        
        // Adjust based on level
        if (selectedLevel === "confident") rizzScore += 10;
        else if (selectedLevel === "romantic") rizzScore += 5;
        
        // Cap at 100
        rizzScore = Math.min(rizzScore, 100);
        
        // Update UI
        rizzMeterFill.style.width = `${rizzScore}%`;
        rizzMeterValue.textContent = `${rizzScore}%`;
      }
    
      // Copy button click handler
      copyButton.addEventListener("click", () => {
        if (selectedResponseIndex === null) return;
    
        const selectedResponse = document.querySelector(`.response-card[data-index="${selectedResponseIndex}"]`);
        if (!selectedResponse) return;
    
        // Copy to clipboard - remove the number prefix
        const textToCopy = selectedResponse.textContent.replace(/^\d+\.\s/, '');
        
        navigator.clipboard
          .writeText(textToCopy)
          .then(() => {
            // Show success feedback
            const originalText = copyButton.textContent;
            copyButton.innerHTML = `
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 4px;">
                <path d="M13.3333 4.66671L6.66666 11.3334L2.66666 7.33337" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Copied!
            `;
            setTimeout(() => {
              copyButton.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 4px;">
                  <rect x="2.66666" y="2.66671" width="8" height="8" rx="1.33333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M5.33334 13.3334H12C12.7364 13.3334 13.3333 12.7364 13.3333 12V5.33337" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Copy
              `;
            }, 2000);
          })
          .catch((err) => {
            console.error("Failed to copy text: ", err);
          });
      });
    
      // Regenerate button click handler
      regenerateButton.addEventListener("click", async () => {
        // Check if user is authenticated
        if (!currentUser) {
          authModal.classList.remove('hidden');
          return;
        }
        
        const message = messageInput.value.trim();
    
        if (!message) {
          alert("Please enter a message or situation first!");
          return;
        }
    
        // Hide error message if it was shown
        errorContainer.classList.add("hidden");
        
        // Show loading state
        loadingElement.classList.remove("hidden");
        chatPreview.classList.add("hidden");
        resultsContainer.classList.add("hidden");
    
        try {
          const responses = await generateResponses(message);
          displayResponses(responses);
          
          // Update Rizz Meter
          updateRizzMeter();
        } catch (error) {
          console.error("Error regenerating responses:", error);
          errorContainer.textContent = error.message || "Something went wrong. Please try again later.";
          errorContainer.classList.remove("hidden");
          chatPreview.classList.remove("hidden");
        } finally {
          // Hide loading state
          loadingElement.classList.add("hidden");
        }
      });
    
      // Mock responses for demo purposes (fallback if API is unavailable)
      function getMockResponses(tone, level, mode, message) {
        const responses = {
          sweet: {
            "low-key": [
              "Just thinking about you and smiling. How's your day going?",
              "Nothing much, but I could definitely make it more interesting. Care to join me?",
              "Just waiting for the right person to make my day better... maybe that's you?",
            ],
            confident: [
              "I've been thinking about our last conversation all day. Can't wait to see you again!",
              "You know, your message was exactly what I needed today. When are we meeting up?",
              "I'm definitely interested in getting to know you better. Coffee this weekend?",
            ],
            roast: [
              "Took you long enough to message me! But I'm glad you did ðŸ˜‰",
              "And here I thought you might have forgotten about me. Nice to know I'm unforgettable ðŸ˜Š",
              "Oh look who finally decided to text! I was starting to think you lost your phone... or your charm ðŸ˜",
            ],
            romantic: [
              "Your message just made my heart skip a beat. Is that your superpower?",
              "Every time I see your name pop up on my screen, the world gets a little brighter âœ¨",
              "If words were stars, yours would be the brightest constellation in my sky tonight ðŸ’«",
            ],
          },
          sarcastic: {
            "low-key": [
              "Oh look, a wild message appears. I choose to respond!",
              "Well well well, if it isn't my favorite person in my notifications ðŸ˜",
              "I was just thinking 'what could make this day better?' and then you texted. Coincidence? I think not.",
              ],
            confident: [
              "I was just betting with myself on when you'd text. I won, by the way.",
              "Finally! I was about to send a search party. Coffee tomorrow? I promise I'm more punctual than my texts.",
              "Ah, so your thumbs DO work! Let's see if your schedule works too - dinner this weekend?",
            ],
            roast: [
              "Wow, you remembered how to text! Should I mark this day on my calendar?",
              "Look who decided I was worth the precious thumb energy today! I'm flattered ðŸ˜‚",
              "I was starting to think you were ghosting me, but I guess even ghosts need someone interesting to talk to ðŸ‘»",
            ],
            romantic: [
              "Oh great, now I have to pretend I wasn't pathetically waiting for your text all day ðŸ’˜",
              "There you go making my heart do that stupid little thing again. How inconsiderate of you ðŸ’“",
              "Fantastic, now I'll be smiling at my phone like an idiot for the rest of the day. Thanks a lot ðŸ’•",
            ],
          },
          bold: {
            "low-key": [
              "I've been thinking about you. What a nice surprise to hear from you.",
              "Perfect timing - I was just about to reach out. Great minds...",
              "Your message just made my evening more interesting ðŸ˜",
            ],
            confident: [
              "I knew you couldn't resist messaging me. When are you free to meet up?",
              "I've been waiting for your text. Let's skip the small talk and plan our date.",
              "I like your initiative. Now let me take the lead - dinner at 8 tomorrow?",
            ],
            roast: [
              "Took you long enough! I was starting to think my charm had worn off ðŸ˜",
              "Finally decided I'm worth your time? Good choice - I'm definitely worth it.",
              "I see you've come to your senses and messaged the most interesting person you know ðŸ˜Ž",
            ],
            romantic: [
              "I've been thinking about you all day. Your message feels like destiny.",
              "There's something about you that I can't ignore. Let's explore this connection.",
              "I believe in being direct - you've been on my mind, and I want to see where this goes.",
            ],
          },
          funny: {
            "low-key": [
              "My phone just did a happy dance when your message came through! Or maybe that was just me ðŸ•º",
              "Breaking news: Attractive person sends message, recipient (me) tries to play it cool and fails miserably ðŸ“°",
              "I was just practicing my telepathy to get you to text me. Clearly, I have superpowers! ðŸ¦¸â€â™‚ï¸",
            ],
            confident: [
              "My fortune cookie said I'd hear from someone special today. Are you stalking my Chinese takeout? ðŸ¥ ",
              "I've scientifically calculated that we should get coffee this weekend. It's for research purposes, obviously ðŸ”¬",
              "My dog just read your message and said I should definitely ask you out. He's very wise for a Labrador ðŸ•",
            ],
            roast: [
              "Oh look who remembered I exist! Did your other, less interesting conversations dry up? ðŸ˜‚",
              "I was just telling my plants about you. They said 'text back faster this time' ðŸŒµ",
              "Wow, a message from you? I should screenshot this rare event for my scrapbook of miracles ðŸ“±",
            ],
            romantic: [
              "My heart just did a cartwheel, pulled a muscle, and is now icing itself down. Look what you've done! â¤ï¸â€ðŸ©¹",
              "Scientists have discovered that your messages release 10x more endorphins than chocolate. I'm addicted! ðŸ«",
              "Is it hot in here or did your message just set fire to my phone? The fire department is on their way! ðŸ”¥",
            ],
          },
          smooth: {
            "low-key": [
              "Just when I thought today couldn't get any better, your name appeared on my screen.",
              "There's something about seeing your message that makes time slow down in the best way possible.",
              "I was just thinking about you. Must be that connection people talk about.",
            ],
            confident: [
              "I've been waiting for the perfect message, and there you are. Let's skip to the part where we're making plans.",
              "Your timing is impeccable. I was just deciding who to share this amazing evening with. Problem solved.",
              "I knew we had a connection from the start. Your message just confirmed it. When are you free to explore this further?",
            ],
            roast: [
              "Fashionably late to my inbox, just like I imagined you'd be. Worth the wait though.",
              "I was starting to think you were playing hard to get. Good thing I enjoy a challenge.",
              "Took your time crafting the perfect message? Don't worry, I appreciate someone who values quality over speed.",
            ],
            romantic: [
              "Some people believe in fate. I'm starting to think they're onto something, especially when I see your message.",
              "There's a certain magic in unexpected messages from extraordinary people. Thanks for bringing that magic into my day.",
              "They say the right words at the right time can change everything. Your message just proved that theory.",
            ],
          },
        };
    
        // For opener mode, use different responses
        if (mode === "opener") {
          return [
            "I noticed you like hiking from your profile. If our first date goes well, think you could handle a sunrise hike with me?",
            "I'm trying to decide if I should start this conversation with a cheesy pickup line or just say hi... what do you think?",
            "I have a theory that people who love [interest from message] make the best conversation partners. Care to help me test it?",
          ];
        }
    
        // For impression mode, use character-specific responses
        if (mode === "impression") {
          const character = impressionInput.value.trim().toLowerCase();
    
          if (character.includes("drake")) {
            return [
              "You know how it goes, started from the bottom of your inbox, now my message is here.",
              "God's plan brought your profile to me. Now I'm just saying, you could do better.",
              "I'm more than just a text, I'm a feeling. One dance with me and you'll see.",
            ];
          } else if (character.includes("stark") || character.includes("iron man")) {
            return [
              "I'm not saying I'm the best catch in your matches, but let's be honest... I am. Genius, billionaire, playboy, philanthropist at your service.",
              "I've analyzed approximately 14,000,605 possible opening lines, and in only one do you actually respond. Let's hope this is the one.",
              "Most people would try to impress you with a fancy line. Me? I'm already impressed with myself. But I'd like to be impressed by you too.",
            ];
          } else if (character.includes("gosling") || character.includes("ryan")) {
            return [
              "Hey... it's not gonna be easy. It's gonna be really hard. We're gonna have to text every day. But I want to do that because I want you.",
              "If you're a bird, I'm a bird. And birds should probably get coffee sometime.",
              "I'm not trying to be dramatic, but I think our match might be written in the stars. What do you say we find out?",
            ];
          } else {
            // Generic character impression
            return [
              "Consider this message the beginning of our epic story. The kind they make movies about someday.",
              "They say imitation is the sincerest form of flattery, but my interest in you is 100% authentic.",
              "If I had a signature catchphrase, this would be it. But instead, I'll just say I'm really looking forward to getting to know you.",
            ];
          }
        }
    
        // Return responses based on tone and level
        return responses[tone][level];
      }
      
      // AI Partner Chat Implementation
      const partnerTypeButtons = document.querySelectorAll('.partner-type-button');
      const personalityButtons = document.querySelectorAll('.personality-button');
      const startChatButton = document.getElementById('start-chat-button');
      const resetChatButton = document.getElementById('reset-chat-button');
      const partnerSetupContainer = document.getElementById('partner-setup-container');
      const partnerChatContainer = document.getElementById('partner-chat-container');
      const partnerLoading = document.getElementById('partner-loading');
      const partnerMessages = document.getElementById('partner-messages');
      const partnerInput = document.getElementById('partner-input');
      const partnerSend = document.getElementById('partner-send');
      const partnerAvatar = document.getElementById('partner-avatar');
      const partnerName = document.getElementById('partner-name');
      const partnerChatTitle = document.getElementById('partner-chat-title');
      
      // Partner chat state
      // let selectedPartnerType = null; // Already declared above
      selectedPersonality = 'sweet';
      partnerSessionId = generateSessionId();
      // let isPartnerTyping = false; // Already declared above
      
      // Setup partner type buttons
      partnerTypeButtons.forEach(button => {
        button.addEventListener('click', () => {
          // Remove selected class from all buttons
          partnerTypeButtons.forEach(btn => {
            btn.classList.remove('selected');
            btn.classList.remove('boyfriend');
            btn.classList.remove('girlfriend');
          });
          
          // Add selected class to clicked button
          selectedPartnerType = button.dataset.partner;
          button.classList.add('selected');
          button.classList.add(selectedPartnerType);
          
          // Update personality buttons
          personalityButtons.forEach(btn => {
            btn.classList.remove('boyfriend');
            btn.classList.remove('girlfriend');
            btn.classList.add(selectedPartnerType);
          });
          
          // Enable start chat button
          startChatButton.disabled = false;
          startChatButton.classList.add(selectedPartnerType);
        });
      });
      
      // Setup personality buttons
      personalityButtons.forEach(button => {
        button.addEventListener('click', () => {
          // Remove active class from all buttons
          personalityButtons.forEach(btn => btn.classList.remove('active'));
          
          // Add active class to clicked button
          button.classList.add('active');
          selectedPersonality = button.dataset.personality;
        });
      });
      
      // Start chat button click handler
      startChatButton.addEventListener('click', () => {
        if (!selectedPartnerType) return;
        partnerSessionId = generateSessionId();
        localStorage.setItem('rizzCoachSession', JSON.stringify({
          sessionId: partnerSessionId,
          partnerType: selectedPartnerType,
          personality: selectedPersonality
        }));
        partnerSetupContainer.classList.add('hidden');
        partnerChatContainer.classList.remove('hidden');
        updatePartnerInfo();
        partnerLoading.classList.remove('hidden');
        setTimeout(() => {
          partnerLoading.classList.add('hidden');
          const welcomeMessage = getWelcomeMessage();
          addPartnerMessage(welcomeMessage);
        }, 1500);
      });
      
      // Reset chat button click handler
      resetChatButton.addEventListener('click', () => {
        partnerMessages.innerHTML = '';
        partnerSessionId = generateSessionId();
        localStorage.setItem('rizzCoachSession', JSON.stringify({
          sessionId: partnerSessionId,
          partnerType: null,
          personality: 'sweet'
        }));
        partnerSetupContainer.classList.remove('hidden');
        partnerChatContainer.classList.add('hidden');
        selectedPartnerType = null;
        partnerTypeButtons.forEach(btn => {
          btn.classList.remove('selected', 'boyfriend', 'girlfriend');
        });
        startChatButton.disabled = true;
        startChatButton.classList.remove('boyfriend', 'girlfriend');
        personalityButtons.forEach(btn => {
          btn.classList.remove('boyfriend', 'girlfriend');
          if (btn.dataset.personality === 'sweet') {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });
        selectedPersonality = 'sweet';
      });
      
      // Partner input keypress handler
      partnerInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessageToPartner();
        }
      });
      
      // Partner send button click handler
      partnerSend.addEventListener('click', () => {
        sendMessageToPartner();
      });
      
      // Function to send message to partner
      async function sendMessageToPartner() {
        const message = partnerInput.value.trim();
        if (!message) return;
        
        // Clear input
        partnerInput.value = '';
        
        // Add user message to chat
        addUserMessage(message);
        
        // Show typing indicator
        showTypingIndicator();
        
        try {
          // Call the API
          const response = await fetch(PARTNER_API_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              message: message,
              session_id: partnerSessionId,
              partner_type: selectedPartnerType,
              personality: selectedPersonality
            })
          });
          
          // Check if the response is ok
          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to get response');
          }
          
          // Parse the response
          const data = await response.json();
          
          // Add a slight delay to simulate typing
          setTimeout(() => {
            // Hide typing indicator
            hideTypingIndicator();
            
            // Add partner message to chat
            addPartnerMessage(data.response);
          }, 1000 + Math.random() * 1000);
        } catch (error) {
          console.error('Error getting partner response:', error);
          
          // Hide typing indicator
          hideTypingIndicator();
          
          // Add fallback response
          setTimeout(() => {
            addPartnerMessage(getFallbackResponse());
          }, 1000);
        }
      }
      
      // Function to add user message to chat
      function addUserMessage(message) {
        const messageElement = document.createElement('div');
        messageElement.classList.add('message', 'message-sent');
        messageElement.textContent = message;
        partnerMessages.appendChild(messageElement);
        
        // Scroll to bottom
        partnerMessages.scrollTop = partnerMessages.scrollHeight;
      }
      
      // Function to add partner message to chat
      function addPartnerMessage(message) {
        const messageElement = document.createElement('div');
        messageElement.classList.add('message', 'message-partner', selectedPartnerType);
        messageElement.textContent = message;
        partnerMessages.appendChild(messageElement);
        
        // Scroll to bottom
        partnerMessages.scrollTop = partnerMessages.scrollHeight;
      }
      
      // Function to show typing indicator
      function showTypingIndicator() {
        if (isPartnerTyping) return;
        
        isPartnerTyping = true;
        
        const typingIndicator = document.createElement('div');
        typingIndicator.classList.add('typing-indicator');
        typingIndicator.id = 'typing-indicator';
        
        for (let i = 0; i < 3; i++) {
          const dot = document.createElement('div');
          dot.classList.add('typing-dot');
          typingIndicator.appendChild(dot);
        }
        
        partnerMessages.appendChild(typingIndicator);
        
        // Scroll to bottom
        partnerMessages.scrollTop = partnerMessages.scrollHeight;
      }
      
      // Function to hide typing indicator
      function hideTypingIndicator() {
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
          typingIndicator.remove();
        }
        
        isPartnerTyping = false;
      }
      
      // Function to update partner info
      function updatePartnerInfo() {
        if (selectedPartnerType === 'boyfriend') {
          partnerAvatar.textContent = 'ðŸ‘¨';
          partnerAvatar.className = 'chat-avatar boyfriend';
          partnerName.textContent = 'Boyfriend';
          partnerChatTitle.textContent = 'Chat with Your Boyfriend';
          partnerSend.className = 'send-button boyfriend';
        } else {
          partnerAvatar.textContent = 'ðŸ‘©';
          partnerAvatar.className = 'chat-avatar girlfriend';
          partnerName.textContent = 'Girlfriend';
          partnerChatTitle.textContent = 'Chat with Your Girlfriend';
          partnerSend.className = 'send-button girlfriend';
        }
      }
      
      // Function to generate a session ID
      function generateSessionId() {
        return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
      }
      
      // Function to get a welcome message
      function getWelcomeMessage() {
        const messages = {
          boyfriend: {
            sweet: "Hey there! I've been thinking about you all day. How are you doing? ðŸ˜Š",
            flirty: "Well hello gorgeous! Just the person I wanted to hear from. What's new in your world? ðŸ˜",
            mysterious: "The universe has a way of connecting souls at just the right moment... How's your day unfolding?",
            passionate: "There you are! My heart skips a beat every time we talk. I've missed you so much! â¤ï¸",
            confident: "Hey! Perfect timing - I was just about to message you. What's going on in your world today?"
          },
          girlfriend: {
            sweet: "Hi sweetie! I was just thinking about you and wondering how your day is going? ðŸ’•",
            flirty: "Well hello there handsome! Just the distraction I was hoping for. What are you up to? ðŸ˜˜",
            mysterious: "Some connections transcend the ordinary... I felt you were about to reach out. How's your day?",
            passionate: "There you are! I've been counting the minutes until we could talk again. I've missed you! â¤ï¸",
            confident: "Hey you! I was just about to message you. Tell me something good about your day."
          }
        };
        
        return messages[selectedPartnerType][selectedPersonality];
      }
      
      // Function to get a fallback response
      function getFallbackResponse() {
        const responses = [
          "I'd love to hear more about that. What else is on your mind?",
          "That's really interesting! Tell me more about your day.",
          "I'm so glad we're talking. What else would you like to chat about?",
          "You always know how to make me smile. What are your plans for later?",
          "I've been thinking about you a lot lately. How has your week been going?"
        ];
        
        return responses[Math.floor(Math.random() * responses.length)];
      }
    });
  </script>
  <svg style="display: none;">
    <symbol id="guest-avatar" viewBox="0 0 100 100">
      <circle cx="50" cy="35" r="20" fill="#7F56D9" />
      <circle cx="50" cy="85" r="30" fill="#7F56D9" />
      <circle cx="40" cy="30" r="3" fill="white" />
      <circle cx="60" cy="30" r="3" fill="white" />
      <path d="M40,45 Q50,55 60,45" stroke="white" stroke-width="2" fill="none" />
    </symbol>
  </svg>
</body>
</html>
